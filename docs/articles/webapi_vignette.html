<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WebAPI functionality • ecmwfr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,300;0,400;0,700;1,300;1,400&amp;display=swap" rel="stylesheet">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- ropensci --><link href="../bglabs.css" rel="stylesheet">
<meta property="og:title" content="WebAPI functionality">
<meta property="og:description" content="ecmwfr">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">

    <div class="navbar-header">

      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="external-link hidden-sm hidden-xs" href="https://bluegreenlabs.org">
          <img src="https://bluegreenlabs.org/img/logo_text_small.png" id="hexlogo" alt="bluegreen labs"></a>
        <a class="external-link hidden-md hidden-lg" href="https://bluegreenlabs.org">
          <img src="https://bluegreenlabs.org/img/logo.png" id="hexlogo" alt="bluegreen labs"></a>
        <a class="navbar-brand" href="../index.html">
           <i>ecmwfr <small>v1.3.0</small></i>
        </a>
      </div>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ads_vignette.html">ADS functionality</a>
    </li>
    <li>
      <a href="../articles/advanced_vignette.html">Advanced Use Cases</a>
    </li>
    <li>
      <a href="../articles/cds_vignette.html">CDS functionality</a>
    </li>
    <li>
      <a href="../articles/webapi_vignette.html">WebAPI functionality</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/bluegreen-labs/ecmwfr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>WebAPI functionality</h1>
                        <h4 data-toc-skip class="author">Koen
Hufkens</h4>
            
            <h4 data-toc-skip class="date">2022-07-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bluegreen-labs/ecmwfr/blob/HEAD/vignettes/webapi_vignette.Rmd" class="external-link"><code>vignettes/webapi_vignette.Rmd</code></a></small>
      <div class="hidden name"><code>webapi_vignette.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="ecmwfr">ecmwfr<a class="anchor" aria-label="anchor" href="#ecmwfr"></a>
</h2>
<p>Programmatic interface to the <a href="https://confluence.ecmwf.int/display/WEBAPI/ECMWF+Web+API+Home" class="external-link">‘ECMWF’
web API services</a>. Allows for easy downloads of ECMWF <a href="https://confluence.ecmwf.int/display/WEBAPI/Access+ECMWF+Public+Datasets" class="external-link">public
data</a>.</p>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>Before starting save your provided ECMWF key to your local keychain.
In this example I use my R development account with the key hidden using
Xs. The package does not allow you to use your key inline in scripts to
limit security issues when sharing scripts on github or otherwise.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># set a key to the keychain</span>
<span class="fu"><a href="../reference/wf_set_key.html">wf_set_key</a></span><span class="op">(</span>user <span class="op">=</span> <span class="st">"khrdev@outlook.com"</span>,
           key <span class="op">=</span> <span class="st">"XXXXXXXXXXXXXXXXXXXXXX"</span>,
           service <span class="op">=</span> <span class="st">"webapi"</span><span class="op">)</span>

<span class="co"># you can retrieve the key using</span>
<span class="fu"><a href="../reference/wf_get_key.html">wf_get_key</a></span><span class="op">(</span>user <span class="op">=</span> <span class="st">"khrdev@outlook.com"</span><span class="op">)</span>

<span class="co"># the output should be the key you provided</span>
<span class="co"># in this case represented by the fake X string.</span>
<span class="co"># "XXXXXXXXXXXXXXXXXXXXXX"</span></code></pre></div>
<p>Alternatively, you can call the <code><a href="../reference/wf_set_key.html">wf_set_key()</a></code> function
with only the service argument. The function will then redirect you to
the correct login page where you can find your login credentials, which
can be copied and pasted into the command prompt.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># set a key to the keychain</span>
<span class="fu"><a href="../reference/wf_set_key.html">wf_set_key</a></span><span class="op">(</span>service <span class="op">=</span> <span class="st">"webapi"</span><span class="op">)</span></code></pre></div>
<p>Before you can download any data you have to make sure to accept the
terms and conditions here: <a href="https://apps.ecmwf.int/datasets/licences/general/" class="external-link">https://apps.ecmwf.int/datasets/licences/general/</a>.</p>
</div>
<div class="section level3">
<h3 id="ecmwf-data-requests-public-data-sets">ECMWF Data Requests (Public Data Sets)<a class="anchor" aria-label="anchor" href="#ecmwf-data-requests-public-data-sets"></a>
</h3>
<p>To download data use the <code><a href="../reference/wf_request.html">wf_request()</a></code> function, together
with your email and a request string syntax <a href="https://confluence.ecmwf.int/display/WEBAPI/Brief+request+syntax#Briefrequestsyntax-Syntax" class="external-link">as
documented</a>. Instead of <code>json</code> formatting the function
uses a simple <code>R</code> list for all the arguments.</p>
<p>The conversion from a MARS or python based query to the list format
can be automated if you use the RStudio based Addin. By selecting and
using Addin -&gt; Mars to list (or ‘Python to list’) you dynamically
convert queries copied from either ECMWF or CDS based services.</p>
<p><img src="https://user-images.githubusercontent.com/1354258/56429601-ced94100-62c3-11e9-82f3-ae2cd03d06f5.gif"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># this is an example of a request</span>
<span class="va">request</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>stream  <span class="op">=</span> <span class="st">"oper"</span>,
                   levtype <span class="op">=</span> <span class="st">"sfc"</span>,
                   param   <span class="op">=</span> <span class="st">"167.128"</span>,
                   dataset <span class="op">=</span> <span class="st">"interim"</span>,
                   step    <span class="op">=</span> <span class="st">"0"</span>,
                   grid    <span class="op">=</span> <span class="st">"0.75/0.75"</span>,
                   time    <span class="op">=</span> <span class="st">"00"</span>,
                   date    <span class="op">=</span> <span class="st">"2014-07-01/to/2014-07-02"</span>,
                   type    <span class="op">=</span> <span class="st">"an"</span>,
                   class   <span class="op">=</span> <span class="st">"ei"</span>,
                   area    <span class="op">=</span> <span class="st">"73.5/-27/33/45"</span>,
                   format  <span class="op">=</span> <span class="st">"netcdf"</span>,
                   target  <span class="op">=</span> <span class="st">"tmp.nc"</span><span class="op">)</span>

<span class="co"># an example download using fw_request()</span>
<span class="co"># using the above request list()</span>
<span class="va">ncfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wf_request.html">wf_request</a></span><span class="op">(</span>user    <span class="op">=</span> <span class="st">"khrdev@outlook.com"</span>,
           request  <span class="op">=</span> <span class="va">request</span>,
           transfer <span class="op">=</span> <span class="cn">TRUE</span>,
           path     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,
           verbose  <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>The download operation might take a while. A progress indicator will
keep you informed on the status of your request. The download will
expire after a default time out of one hour. You will be informed of
where to track your job request on <a href="https://apps.ecmwf.int/webmars/joblist/" class="external-link">the ECMWF website</a>,
and provided with a download url which can be used with the
<code>wt_transfer()</code> funtion to download the data on a later
moment. Keep in mind that you can only have 3 active downloads and 20
job items queued!</p>
<p>If the download is successful you can visualize one layer in the
retrieved stack of temperatures at 2 meters using the plotting routine
below.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="va">ncfile</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span>
<span class="co">#&gt; class      : RasterStack </span>
<span class="co">#&gt; dimensions : 55, 97, 5335, 1  (nrow, ncol, ncell, nlayers)</span>
<span class="co">#&gt; resolution : 0.75, 0.75  (x, y)</span>
<span class="co">#&gt; extent     : -27.375, 45.375, 32.625, 73.875  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; names      :    layer </span>
<span class="co">#&gt; min values : 268.5063 </span>
<span class="co">#&gt; max values : 305.4419</span>

<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"2 meter temperature (Kelvin)"</span><span class="op">)</span>
<span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="st">"world"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="webapi_vignette_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="ecmwf-mars-requests">ECMWF mars Requests<a class="anchor" aria-label="anchor" href="#ecmwf-mars-requests"></a>
</h3>
<p>The <code>ecmwfr</code> package (<a href="../references/wf_request.html"><code>wf_request()</code></a>) also
allows to submit <em>mars</em> requests. Note that this requires a
member state login or a commercial user account!</p>
<p>The <code>ecmwfr</code> syntax for <em>mars</em> requests is
identical to the ones to the public ECMWF API except that one has to
specify <code>dataset = "mars"</code>. The example below downloads the 2
meter temperature forecast (parameter <code>167</code>) from the 00 UTC
ECMWF HRES run January 22, 2019, only 12 ahead forecast
(<code>step</code>). A NetCDF file with a regular
<code>0.125 x 0.125</code> degree horizontal resolution for a custom
area in northern Europe will be downloaded (<code>area</code>).
<strong>Note</strong> that the <code>grid</code> specification <em>is
required</em> if <code>format = "netcdf"</code> as grib to NetCDF
conversion is only able for regular longitude-latitude grids.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># this is an example of a request</span>
<span class="va">request</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"dataset"</span> <span class="op">=</span> <span class="st">"mars"</span>,
                   <span class="st">"class"</span>   <span class="op">=</span> <span class="st">"od"</span>,
                   <span class="st">"date"</span>    <span class="op">=</span> <span class="st">"2019-01-22"</span>,
                   <span class="st">"expver"</span>  <span class="op">=</span> <span class="st">"1"</span>,
                   <span class="st">"levtype"</span> <span class="op">=</span> <span class="st">"sfc"</span>,
                   <span class="st">"param"</span>   <span class="op">=</span> <span class="st">"167.128"</span>,
                   <span class="st">"step"</span>    <span class="op">=</span> <span class="st">"0"</span>,
                   <span class="st">"stream"</span>  <span class="op">=</span> <span class="st">"oper"</span>,
                   <span class="st">"time"</span>    <span class="op">=</span> <span class="st">"12"</span>,
                   <span class="st">"type"</span>    <span class="op">=</span> <span class="st">"fc"</span>,
                   <span class="st">"grid"</span>    <span class="op">=</span> <span class="st">"0.125/0.125"</span>,
                   <span class="st">"area"</span>    <span class="op">=</span> <span class="st">"50/0/30/15"</span>,
                   <span class="st">"format"</span>  <span class="op">=</span> <span class="st">"netcdf"</span>,
                   <span class="st">"target"</span>  <span class="op">=</span> <span class="st">"mars-data.nc"</span><span class="op">)</span>

<span class="co"># Submit mars request and wait for netcdf file</span>
<span class="fu"><a href="../reference/wf_request.html">wf_request</a></span><span class="op">(</span>user    <span class="op">=</span> <span class="st">"khrdev@outlook.com"</span>,
           transfer <span class="op">=</span> <span class="cn">TRUE</span>,
           path     <span class="op">=</span> <span class="st">"~"</span>,
           request  <span class="op">=</span> <span class="va">request</span>,
           verbose  <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="listing-ancillary-data">Listing Ancillary data<a class="anchor" aria-label="anchor" href="#listing-ancillary-data"></a>
</h3>
<p>You can list ancillary data such as user information, datasets and
services using the following calls.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># user info</span>
<span class="va">user_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wf_user_info.html">wf_user_info</a></span><span class="op">(</span>user <span class="op">=</span> <span class="st">"khrdev@outlook.com"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">user_info</span><span class="op">)</span>

<span class="co"># services</span>
<span class="va">services</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wf_services.html">wf_services</a></span><span class="op">(</span>user <span class="op">=</span> <span class="st">"khrdev@outlook.com"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">services</span><span class="op">)</span>

<span class="co"># datasets</span>
<span class="va">datasets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wf_datasets.html">wf_datasets</a></span><span class="op">(</span>user <span class="op">=</span> <span class="st">"khrdev@outlook.com"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">datasets</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start bottom-8">
            <div class="col-xs-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="http://github.com/bluegreen-labs" target="_blank" class="external-link">
                          <div class="icon fab fa-github"></div></a>
                        <a href="https://bluegreenlabs.org/labs/" target="_blank" class="external-link">
                          <div class="icon fa fa-flask"></div></a>
                        <a href="http://twitter.com/bluegreen_labs" target="_blank" class="external-link">
                          <div class="icon fab fa-twitter"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://bluegreenlabs.org/#intro" class="external-link">BlueGreen Labs</a></li>
                            <li><a href="https://bluegreenlabs.org/#people" class="external-link">Our Team</a></li>
                            <li><a href="https://bluegreenlabs.org/#contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://github.com/bluegreen-labs" class="external-link">Packages</a></li>
                            <li><a href="https://bluegreenlabs.org/publication/" class="external-link">Publications</a></li>
                            <li><a href="https://bluegreenlabs.org/post/" class="external-link">Blog</a></li>
                        </ul>
</div>

                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->

      </footer>
</div>

  


  

  </body>
</html>
